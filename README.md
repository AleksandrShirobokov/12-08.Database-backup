# «Резервное копирование баз данных»
# Александр Широбоков
## Задание 1. Резервное копирование
### Кейс: финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.
**Необходимо описать, какие варианты резервного копирования подходят в случаях:**
 - Необходимо восстанавливать данные в полном объёме за предыдущий день.
 - Необходимо восстанавливать данные за час до предполагаемой поломки.
 - Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Варианты резервного копирования, которые подходят в различных сценариях:*

 - **Восстановление данных за предыдущий день:**

***Шаг 1:*** Установите систему автоматического регулярного резервного копирования баз данных. 
 
***Шаг 2:*** Запланируйте задачу резервного копирования на конец каждого рабочего дня. 
 
***Шаг 3:*** Убедитесь, что все необходимые базы данных включены в задачу резервного копирования. 
 
***Шаг 4:*** Убедитесь, что копии баз данных сохраняются на отдельных надежных хранилищах, отделенных от основных систем. 
 

 - **Восстановление данных за час до предполагаемой поломки:**

***Шаг 1:*** Установите систему регулярных точечных резервных копий, которая будет создавать копии баз данных каждый час.
 
***Шаг 2:*** Синхронизируйте резервные копии с основными базами данных или используйте механизмы репликации для поддержания актуальности данных.
 
***Шаг 3:*** Сохраняйте эти резервные копии на отдельных физических устройствах или удаленных серверах для повышения надежности и защиты от физических повреждений.
 

 - **Моментальное переключение на работающую или починенную базу данных:**

***Шаг 1:*** Разработайте и реализуйте систему высокой доступности (High Availability, HA), которая обеспечивает наличие резервной базы данных, готовой к моментальному переключению в случае поломки основной базы данных.
 
***Шаг 2:*** Используйте механизмы репликации баз данных, такие как master-master или master-slave, чтобы обеспечить синхронизацию данных между основной и резервной базами данных.
 
***Шаг 3:*** Настройте систему мониторинга, которая непрерывно отслеживает состояние основной базы данных и автоматически переключает трафик на резервную базу данных в случае обнаружения сбоя.
 
## Задание 2. PostgreSQL
 - *С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).*
 - *Возможно ли автоматизировать этот процесс? Если да, то как?*

Команда pg_dump используется для резервирования данных PostgreSQL, а команда pg_restore — для восстановления резервных копий БД. Примеры использования этих команд:

**Команда pg_dump для резервирования данных:**
```
pg_dump -U <username> -d <database_name> -f <output_file>
```
Пример:
```
pg_dump -U myuser -d mydatabase -f backup.sql
```
*Эта команда создаст резервную копию базы данных mydatabase в файле backup.sql.*

**Команда pg_restore для восстановления данных:**
```
pg_restore -U <username> -d <database_name> <input_file>
```
Пример:

```
pg_restore -U myuser -d mydatabase backup.sql
```
*Эта команда восстановит данные из файла backup.sql в базу данных mydatabase.*

**Относительно автоматизации процесса резервирования и восстановления данных, можно использовать различные методы в зависимости от потребностей:**

 - Создание расписания: можно создать расписание (например, с помощью cron на Linux) для запуска команды pg_dump и автоматического создания регулярных резервных копий.

 - Сценарий резервного копирования: можно написать сценарий на предпочитаемом языке программирования, который будет выполнять команду pg_dump с определенной периодичностью и сохранять резервные копии в заданном месте.

 - Автоматическое восстановление: Если есть система резервного копирования, которая сохраняет резервные копии БД, можно создать сценарий или скрипт, который автоматически восстанавливает базу данных из последней резервной копии.

 - Использование инструментов управления базами данных: некоторые инструменты управления базами данных предоставляют функциональность автоматического резервного копирования и восстановления. Например, инструменты резервного копирования PostgreSQL, такие как pgBackRest или Barman, обеспечивают автоматическое резервное копирование и восстановление БД.

## Задание 3. MySQL
 - *С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.*
 - *В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?*

Для инкрементного резервного копирования базы данных MySQL можно использовать команду mysqldump в сочетании с опцией **--single-transaction**. Вот пример команды:
```
mysqldump --single-transaction --user=<username> --password=<password> <database_name> > <output_file>
```
Пример:
```
mysqldump --single-transaction --user=myuser --password=mypassword mydatabase > backup.sql
```
*Эта команда создаст инкрементную резервную копию базы данных mydatabase в файле backup.sql с использованием транзакции для обеспечения консистентности данных.*

**Относительно преимуществ использования реплики базы данных MySQL по сравнению с обычным резервным копированием, вот несколько случаев, когда репликация может быть полезной:**

 - Высокая доступность: репликация позволяет иметь доступную копию базы данных, которая может использоваться для чтения или для обслуживания запросов при отказе основной базы данных. Если основная база данных становится недоступной, реплика может быть использована для продолжения работы системы без простоев.

 - Горизонтальное масштабирование чтения: репликация позволяет распределить нагрузку на чтение между несколькими репликами базы данных. Это особенно полезно в случаях, когда система испытывает высокую нагрузку на чтение, и реплики могут обрабатывать запросы параллельно, улучшая производительность и отзывчивость системы.

 - Резервное копирование без простоев: использование реплики позволяет выполнять резервное копирование без простоев для основной базы данных. Резервные копии могут быть созданы на реплике без влияния на работу основной базы данных и приложений, которые к ней подключены.

 - Тестирование и анализ: реплика может быть использована для тестирования обновлений или новых функций без влияния на рабочую базу данных. Это позволяет проверять изменения в реальном окружении до их применения на основной базе данных.

В целом, использование реплики базы данных MySQL может быть выгодным для обеспечения высокой доступности, масштабируемости чтения, резервного копирования без простоев и тестирования. Однако, репликация также требует дополнительных ресурсов и конфигурации, и может быть сложнее в настройке и управлении по сравнению с обычным резервным копированием. Поэтому выбор метода зависит от конкретных требований и ограничений.
